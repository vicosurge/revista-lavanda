{{ define "main" }}
<div class="submission-page">
    <div class="container">
        <article class="single-content">
            <header class="content-header">
                <h1 class="content-title">{{ .Title }}</h1>
            </header>
            
            <div class="content-body">
                {{ .Content }}
            </div>
        </article>
        
        <!-- Make.com Webhook Form -->
        <form action="https://hook.us2.make.com/po5i6hhdgv8nii0fhi8v2dgwwo5j4lje" method="POST" class="submission-form" id="submission-form">
            <div class="form-group">
                <label for="nombre" class="form-label">Nombre completo *</label>
                <input type="text" id="nombre" name="nombre" class="form-input" required>
            </div>
            
            <div class="form-group">
                <label for="email" class="form-label">Correo electrónico *</label>
                <input type="email" id="email" name="email" class="form-input" required>
            </div>
            
            <div class="form-group">
                <label for="tipo" class="form-label">Tipo de trabajo *</label>
                <select id="tipo" name="tipo" class="form-select" required>
                    <option value="">Selecciona una opción</option>
                    <option value="cuento">Cuento</option>
                    <option value="poesia">Poesía</option>
                    <option value="ensayo">Ensayo</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="titulo" class="form-label">Título del trabajo *</label>
                <input type="text" id="titulo" name="titulo" class="form-input" required>
            </div>
            
            <div class="form-group">
                <label for="bio" class="form-label">Biografía breve (máximo 100 palabras)</label>
                <textarea id="bio" name="bio" class="form-textarea" rows="3" maxlength="500"></textarea>
            </div>
            
            <div class="form-group">
                <label for="trabajo" class="form-label">Tu trabajo *</label>
                <textarea id="trabajo" name="trabajo" class="form-textarea" required rows="15" placeholder="Pega aquí el texto completo de tu trabajo..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="notas" class="form-label">Notas adicionales</label>
                <textarea id="notas" name="notas" class="form-textarea" rows="3"></textarea>
            </div>
            
            <button type="submit" class="form-submit" id="submit-btn">Enviar Trabajo</button>
            
            <div id="form-status" style="display: none; margin-top: 1rem; padding: 1rem; border-radius: 6px; text-align: center;"></div>
        </form>
    </div>
</div>

<script>
document.getElementById('submission-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const form = e.target;
    const submitBtn = document.getElementById('submit-btn');
    const statusDiv = document.getElementById('form-status');
    
    // Show loading state
    submitBtn.textContent = 'Enviando...';
    submitBtn.disabled = true;
    statusDiv.style.display = 'none';
    
    // Prepare form data
    const formData = new FormData(form);
    
    // Send to Make.com webhook
    fetch(form.action, {
        method: 'POST',
        body: formData,
    })
    .then(response => {
        if (response.ok) {
            // Success
            statusDiv.innerHTML = '✅ ¡Gracias! Tu trabajo ha sido enviado correctamente. Te contactaremos pronto.';
            statusDiv.style.backgroundColor = '#d4edda';
            statusDiv.style.color = '#155724';
            statusDiv.style.border = '1px solid #c3e6cb';
            statusDiv.style.display = 'block';
            form.reset();
        } else {
            throw new Error('Error en el envío');
        }
    })
    .catch(error => {
        // Error
        statusDiv.innerHTML = '❌ Hubo un error al enviar tu trabajo. Por favor, inténtalo de nuevo o envíanos un email directamente.';
        statusDiv.style.backgroundColor = '#f8d7da';
        statusDiv.style.color = '#721c24';
        statusDiv.style.border = '1px solid #f5c6cb';
        statusDiv.style.display = 'block';
    })
    .finally(() => {
        // Reset button
        submitBtn.textContent = 'Enviar Trabajo';
        submitBtn.disabled = false;
    });
});
</script>
{{ end }}
