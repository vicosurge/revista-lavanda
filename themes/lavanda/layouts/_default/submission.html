{{ define "main" }}
<div class="submission-page">
    <div class="container">
        <article class="single-content">
            <header class="content-header">
                <h1 class="content-title">{{ .Title }}</h1>
            </header>
            
            <div class="content-body">
                {{ .Content }}
            </div>
        </article>
        
        <form action="https://api-six-nu-30.vercel.app/api/submit-form" method="POST" enctype="multipart/form-data" class="submission-form" id="submission-form">
            <div class="form-group">
                <label for="nombre" class="form-label">Nombre completo *</label>
                <input type="text" id="nombre" name="nombre" class="form-input" required>
            </div>
            
            <div class="form-group">
                <label for="email" class="form-label">Correo electrónico *</label>
                <input type="email" id="email" name="email" class="form-input" required>
            </div>
            
            <div class="form-group">
                <label for="tipo" class="form-label">Tipo de trabajo *</label>
                <select id="tipo" name="tipo" class="form-select" required>
                    <option value="">Selecciona una opción</option>
                    <option value="cuento">Cuento</option>
                    <option value="poesia">Poesía</option>
                    <option value="ensayo">Ensayo</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="titulo" class="form-label">Título del trabajo *</label>
                <input type="text" id="titulo" name="titulo" class="form-input" required>
            </div>
            
            <div class="form-group">
                <label for="bio" class="form-label">Biografía breve (máximo 100 palabras)</label>
                <textarea id="bio" name="bio" class="form-textarea" rows="3" maxlength="500"></textarea>
            </div>
            
            <!-- File Upload Section -->
            <div class="form-group">
                <label for="archivo" class="form-label">Archivo del trabajo *</label>
                <input type="file" id="archivo" name="archivo" class="form-file" required 
                       accept=".docx,.doc,.odt,.rtf,.txt"
                       onchange="validateFile(this)">
                <div class="file-info">
                    <small>Formatos permitidos: DOCX, DOC, ODT, RTF, TXT (máximo 10MB)</small>
                </div>
                <div id="file-error" class="file-error" style="display: none;"></div>
            </div>
            
            <div class="form-group">
                <label for="notas" class="form-label">Notas adicionales</label>
                <textarea id="notas" name="notas" class="form-textarea" rows="3" placeholder="Cualquier información adicional sobre tu trabajo..."></textarea>
            </div>
            
            <button type="submit" class="form-submit" id="submit-btn">Enviar Trabajo</button>
            
            <div id="form-status" style="display: none; margin-top: 1rem; padding: 1rem; border-radius: 6px; text-align: center;"></div>
        </form>
    </div>
</div>

<script>
// File validation
function validateFile(input) {
    const file = input.files[0];
    const errorDiv = document.getElementById('file-error');
    const submitBtn = document.getElementById('submit-btn');
    
    if (!file) return;
    
    // Check file size (10MB = 10 * 1024 * 1024 bytes)
    const maxSize = 10 * 1024 * 1024;
    if (file.size > maxSize) {
        errorDiv.textContent = 'El archivo es demasiado grande. Máximo 10MB permitido.';
        errorDiv.style.display = 'block';
        errorDiv.style.color = '#dc3545';
        input.value = '';
        return;
    }
    
    // Check file type
    const allowedTypes = ['.docx', '.doc', '.odt', '.rtf', '.txt'];
    const fileName = file.name.toLowerCase();
    const isValidType = allowedTypes.some(type => fileName.endsWith(type));
    
    if (!isValidType) {
        errorDiv.textContent = 'Formato de archivo no permitido. Solo se aceptan: DOCX, DOC, ODT, RTF, TXT';
        errorDiv.style.display = 'block';
        errorDiv.style.color = '#dc3545';
        input.value = '';
        return;
    }
    
    // File is valid
    errorDiv.style.display = 'none';
    errorDiv.textContent = `✓ Archivo válido: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
    errorDiv.style.display = 'block';
    errorDiv.style.color = '#28a745';
}

document.getElementById('submission-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const form = e.target;
    const submitBtn = document.getElementById('submit-btn');
    const statusDiv = document.getElementById('form-status');
    const fileInput = document.getElementById('archivo');
    
    // Validate file is selected
    if (!fileInput.files[0]) {
        statusDiv.innerHTML = '❌ Por favor selecciona un archivo antes de enviar.';
        statusDiv.style.backgroundColor = '#f8d7da';
        statusDiv.style.color = '#721c24';
        statusDiv.style.border = '1px solid #f5c6cb';
        statusDiv.style.display = 'block';
        return;
    }
    
    // Show loading state
    submitBtn.textContent = 'Enviando archivo...';
    submitBtn.disabled = true;
    statusDiv.style.display = 'none';
    
    // Prepare form data
    const formData = new FormData(form);
    
    // Send to Make.com webhook
    fetch(form.action, {
        method: 'POST',
        body: formData,
    })
    .then(response => {
        if (response.ok) {
            // Success
            statusDiv.innerHTML = '✅ ¡Gracias! Tu trabajo ha sido enviado correctamente. Te contactaremos pronto.';
            statusDiv.style.backgroundColor = '#d4edda';
            statusDiv.style.color = '#155724';
            statusDiv.style.border = '1px solid #c3e6cb';
            statusDiv.style.display = 'block';
            form.reset();
        } else {
            throw new Error('Error en el envío');
        }
    })
    .catch(error => {
        // Error
        statusDiv.innerHTML = '❌ Hubo un error al enviar tu trabajo. Por favor, inténtalo de nuevo o envíanos un email directamente.';
        statusDiv.style.backgroundColor = '#f8d7da';
        statusDiv.style.color = '#721c24';
        statusDiv.style.border = '1px solid #f5c6cb';
        statusDiv.style.display = 'block';
    })
    .finally(() => {
        // Reset button
        submitBtn.textContent = 'Enviar Trabajo';
        submitBtn.disabled = false;
    });
});
</script>
{{ end }}
